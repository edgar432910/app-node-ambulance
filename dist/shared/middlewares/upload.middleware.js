"use strict";var __importDefault=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(exports,"__esModule",{value:!0}),exports.FactoryAzure=exports.FactoryGoogle=exports.FactoryAWS=void 0;const multer_1=__importDefault(require("multer")),multer_s3_1=__importDefault(require("multer-s3")),yenv_1=__importDefault(require("yenv")),client_s3_1=require("@aws-sdk/client-s3"),env=(0,yenv_1.default)();class FactoryAWS{saveMultiple(e){return(0,multer_1.default)({limits:{fileSize:e.maxFileSize},storage:(0,multer_s3_1.default)({s3:new client_s3_1.S3Client({}),bucket:env.S3.bucketName,acl:e.isPublic?"public-read":"",metadata(e,t,l){l(null,{fiedName:t.fieldname})},key:(t,l,r)=>{const i=l.mimetype,o=e.mimeTypesAllowed.includes(i);if(l.size>e.maxFileSize){const e=new Error("File too large");return e.status=422,r(e,null)}if(!o){const e=new Error("File type not allowed");return e.code="LIMIT_FILE_TYPES",e.status=422,r(e,null)}const a=l.originalname.split("."),s=Date.now().toString(),n=a[a.length-1],u=`${e.directory}/${s}.${n}`;t.body[e.fieldName]=u,r(null,u)}})}).single(e.fieldName)}save(e){return(0,multer_1.default)({limits:{fileSize:e.maxFileSize},storage:(0,multer_s3_1.default)({s3:new client_s3_1.S3Client({}),bucket:env.S3.bucketName,acl:e.isPublic?"public-read":"",metadata(e,t,l){l(null,{fiedName:t.fieldname})},key:(t,l,r)=>{const i=l.mimetype,o=e.mimeTypesAllowed.includes(i);if(l.size>e.maxFileSize){const e=new Error("File too large");return e.status=422,r(e,null)}if(!o){const e=new Error("File type not allowed");return e.code="LIMIT_FILE_TYPES",e.status=422,r(e,null)}const a=l.originalname.split("."),s=Date.now().toString(),n=a[a.length-1],u=`${e.directory}/${s}.${n}`;t.body[e.fieldName]=u,r(null,u)}})}).single(e.fieldName)}}exports.FactoryAWS=FactoryAWS;class FactoryGoogle{save(e){return!1}}exports.FactoryGoogle=FactoryGoogle;class FactoryAzure{save(e){return!1}}exports.FactoryAzure=FactoryAzure;